<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Proposal Maker - Systems Plus College Foundation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --paper-width: 8.5in;
            --paper-height: 11in;
            --paper-margin: 1in;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }

        .main-container {
            padding: 2rem;
            min-height: 100vh;
        }

        .editor-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .paper-container {
            background: white;
            width: 100%;
            max-width: 800px;
            min-height: 600px;
            margin: 2rem auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }

        .paper-page {
            width: 100%;
            min-height: 600px;
            padding: 2rem;
            box-sizing: border-box;
            page-break-after: always;
            display: none;
            overflow: auto;
        }

        .paper-page.active {
            display: block;
        }

        .paper-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 1rem;
        }

        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .header-center {
            text-align: center;
            flex-grow: 1;
            margin: 0 2rem;
        }

        .college-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .department-name {
            font-size: 1rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
        }

        /* Department Colors */
        .dept-engineering { background: #e74c3c; color: white; }
        .dept-business { background: #3498db; color: white; }
        .dept-education { background: #27ae60; color: white; }
        .dept-arts { background: #9b59b6; color: white; }
        .dept-science { background: #f39c12; color: white; }

        .form-section {
            margin-bottom: 1rem;
        }

        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .form-control, .form-select {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 0.5rem;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .budget-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .budget-table th,
        .budget-table td {
            border: 1px solid #dee2e6;
            padding: 0.5rem;
            text-align: left;
        }

        .budget-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .budget-input {
            width: 100%;
            border: none;
            padding: 0.25rem;
            background: transparent;
        }

        .budget-input:focus {
            outline: 2px solid #667eea;
            background: #f8f9fa;
        }

        .btn-enhanced {
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary-enhanced {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary-enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-outline-enhanced {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline-enhanced:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .page-controls {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 1000;
        }

        .split-layout {
            display: block;
        }

        .editor-column {
            width: 100%;
        }

        .preview-column {
            width: 100%;
            position: relative;
        }

        .page-indicator {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .proposal-content {
            line-height: 1.6;
        }

        .proposal-section {
            margin-bottom: 1.5rem;
            page-break-inside: avoid;
        }

        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .section-content {
            margin-left: 1rem;
            text-align: justify;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .bullet-list {
            margin-left: 2rem;
        }

        .bullet-list li {
            margin-bottom: 0.25rem;
        }

        @media print {
            body {
                background: white;
            }
            
            .editor-panel,
            .page-controls {
                display: none !important;
            }
            
            .paper-container {
                box-shadow: none;
                margin: 0;
            }
            
            .paper-page {
                display: block !important;
                page-break-after: always;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
            
            .editor-panel {
                padding: 1.5rem;
            }
            
            .paper-container {
                margin: 1rem auto;
                max-width: 95%;
            }
            
            .paper-page {
                padding: 1rem;
            }
        }

        .preview-mode .editor-column {
            display: none;
        }

        .preview-mode .preview-column {
            display: block;
        }

        .total-row {
            background: #f8f9fa;
            font-weight: bold;
        }

        .add-row-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .remove-row-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-size: 0.7rem;
        }

        .program-calendar-container {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .program-header {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 60px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .time-column-header,
        .activity-column-header,
        .action-column-header {
            padding: 0.75rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: #2c3e50;
            border-right: 1px solid #dee2e6;
        }

        .action-column-header {
            border-right: none;
            text-align: center;
        }

        .program-row {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr 60px;
            border-bottom: 1px solid #dee2e6;
            transition: background-color 0.2s ease;
        }

        .program-row:hover {
            background: #f8f9fa;
        }

        .time-selector {
            padding: 0.75rem;
            border-right: 1px solid #dee2e6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            background: white;
        }

        .time-selector:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }

        .time-selector.selected {
            background: #667eea;
            color: white;
        }

        .time-display {
            font-size: 0.85rem;
            color: #495057;
        }

        .time-selector.selected .time-display {
            color: white;
        }

        .time-selector i {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        .activity-input-container {
            padding: 0.5rem;
            border-right: 1px solid #dee2e6;
        }

        .activity-input {
            width: 100%;
            border: none;
            padding: 0.25rem;
            background: transparent;
            font-size: 0.85rem;
            outline: none;
        }

        .activity-input:focus {
            background: #f8f9fa;
            border-radius: 4px;
        }

        .action-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }

        .add-program-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .add-program-btn:hover {
            background: #218838;
        }

        .remove-program-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .remove-program-btn:hover {
            background: #c82333;
        }

        /* Time Picker Modal Styles */
        .time-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .time-modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .time-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .time-modal-header h5 {
            margin: 0;
            color: #2c3e50;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: #dc3545;
        }

        .time-picker-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .time-picker-section {
            text-align: center;
        }

        .time-picker-section label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .time-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1rem;
            text-align: center;
            background: white;
        }

        .time-select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .time-modal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }

        .btn-cancel,
        .btn-confirm {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-confirm {
            background: #667eea;
            color: white;
        }

        .btn-confirm:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="container-fluid">
            <div class="split-layout">
                <!-- Editor Column -->
                <div class="editor-column">
                    <div class="editor-panel" id="editor-panel">
                        <h4 class="text-center mb-3">
                            <i class="bi bi-file-earmark-text me-2"></i>
                            Project Proposal Maker
                        </h4>

                        <!-- Basic Information -->
                        <div class="form-section">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="proposal-date">
                        </div>

                        <div class="form-section">
                            <label class="form-label">Project Organizer</label>
                            <input type="text" class="form-control" id="project-organizer" placeholder="Enter project organizer">
                        </div>

                        <div class="form-section">
                            <label class="form-label">Support</label>
                            <textarea class="form-control" id="support" rows="2" placeholder="Enter support details"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Project Title</label>
                            <input type="text" class="form-control" id="project-title" placeholder="Enter project title">
                        </div>

                        <div class="form-section">
                            <label class="form-label">Lead Facilitator</label>
                            <input type="text" class="form-control" id="lead-facilitator" placeholder="Enter lead facilitator">
                        </div>

                        <div class="form-section">
                            <label class="form-label">Department</label>
                            <select class="form-select" id="department">
                                <option value="">Select Department</option>
                                <option value="engineering">Engineering</option>
                                <option value="business">Business</option>
                                <option value="education">Education</option>
                                <option value="arts">Arts & Sciences</option>
                                <option value="science">Computer Science</option>
                            </select>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Rationale</label>
                            <textarea class="form-control" id="rationale" rows="3" placeholder="Enter project rationale"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Objectives (one per line)</label>
                            <textarea class="form-control" id="objectives" rows="3" placeholder="Enter objectives, one per line"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Intended Learning Outcomes (one per line)</label>
                            <textarea class="form-control" id="learning-outcomes" rows="3" placeholder="Enter learning outcomes, one per line"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Source of Budget</label>
                            <input type="text" class="form-control" id="budget-source" placeholder="Enter budget source">
                        </div>

                <!-- Budget Requirements Table -->
                <div class="form-section">
                    <label class="form-label">Budget Requirements</label>
                    <div class="table-responsive">
                        <table class="budget-table" id="budget-table">
                            <thead>
                                <tr>
                                    <th>Unit</th>
                                    <th>Unit Price</th>
                                    <th>Size</th>
                                    <th>Quantity</th>
                                    <th>Total Price</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="budget-tbody">
                                <tr>
                                    <td><input type="text" class="budget-input" placeholder="Item name"></td>
                                    <td><input type="number" class="budget-input unit-price" placeholder="0.00" step="0.01"></td>
                                    <td><input type="text" class="budget-input" placeholder="Size/Description"></td>
                                    <td><input type="number" class="budget-input quantity" placeholder="1" min="1"></td>
                                    <td class="total-price">₱0.00</td>
                                    <td><button type="button" class="remove-row-btn" onclick="removeRow(this)">×</button></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="total-row">
                                    <td colspan="4" style="text-align: right; font-weight: bold;">Grand Total:</td>
                                    <td id="grand-total">₱0.00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                        <button type="button" class="add-row-btn" onclick="addBudgetRow()">+ Add Row</button>
                    </div>
                </div>

                        <div class="form-section">
                            <label class="form-label">Mechanics</label>
                            <textarea class="form-control" id="mechanics" rows="3" placeholder="Enter project mechanics"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Schedule</label>
                            <textarea class="form-control" id="schedule" rows="3" placeholder="Enter event dates, start time, and end time (e.g., March 15-16, 2024, 9:00 AM - 5:00 PM)"></textarea>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Program Schedule</label>
                            <div class="program-calendar-container">
                                <div class="program-header">
                                    <div class="time-column-header">Start Time</div>
                                    <div class="time-column-header">End Time</div>
                                    <div class="activity-column-header">Activity Description</div>
                                    <div class="action-column-header">Action</div>
                                </div>
                                <div id="program-rows">
                                    <div class="program-row">
                                        <div class="time-selector" onclick="openTimeSelector(this, 'start')">
                                            <span class="time-display">Click to select time</span>
                                            <i class="bi bi-clock"></i>
                                        </div>
                                        <div class="time-selector" onclick="openTimeSelector(this, 'end')">
                                            <span class="time-display">Click to select time</span>
                                            <i class="bi bi-clock"></i>
                                        </div>
                                        <div class="activity-input-container">
                                            <input type="text" class="activity-input" placeholder="Enter activity description">
                                        </div>
                                        <div class="action-container">
                                            <button type="button" class="remove-program-btn" onclick="removeProgramRow(this)">×</button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="add-program-btn" onclick="addProgramRow()">+ Add Activity</button>
                            </div>
                        </div>

                        <!-- Time Picker Modal -->
                        <div id="time-picker-modal" class="time-modal" style="display: none;">
                            <div class="time-modal-content">
                                <div class="time-modal-header">
                                    <h5>Select Time</h5>
                                    <button type="button" class="close-modal" onclick="closeTimeModal()">×</button>
                                </div>
                                <div class="time-picker-container">
                                    <div class="time-picker-section">
                                        <label>Hour</label>
                                        <select id="hour-select" class="time-select">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9" selected>9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                    <div class="time-picker-section">
                                        <label>Minute</label>
                                        <select id="minute-select" class="time-select">
                                            <option value="00" selected>00</option>
                                            <option value="15">15</option>
                                            <option value="30">30</option>
                                            <option value="45">45</option>
                                        </select>
                                    </div>
                                    <div class="time-picker-section">
                                        <label>AM/PM</label>
                                        <select id="ampm-select" class="time-select">
                                            <option value="AM" selected>AM</option>
                                            <option value="PM">PM</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="time-modal-actions">
                                    <button type="button" class="btn-cancel" onclick="closeTimeModal()">Cancel</button>
                                    <button type="button" class="btn-confirm" onclick="confirmTimeSelection()">Confirm</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <label class="form-label">Venue</label>
                            <textarea class="form-control" id="venue" rows="3" placeholder="Enter venue details"></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-enhanced btn-primary-enhanced btn-sm" onclick="generateProposal()">
                                <i class="bi bi-file-earmark-text me-1"></i>Generate
                            </button>
                            <button type="button" class="btn btn-enhanced btn-outline-enhanced btn-sm" onclick="printProposal()">
                                <i class="bi bi-printer me-1"></i>Print
                            </button>
                            <button type="button" class="btn btn-enhanced btn-outline-enhanced btn-sm" onclick="togglePreview()">
                                <i class="bi bi-eye me-1"></i>Toggle Preview
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preview Column -->
                <div class="preview-column">
                    <div class="paper-container" id="paper-container">
                        <!-- Pages will be dynamically generated here -->
                    </div>

                    <!-- Page Controls -->
                    <div class="page-controls" id="page-controls" style="display: none;">
                        <button type="button" class="btn btn-enhanced btn-outline-enhanced btn-sm" onclick="previousPage()">
                            <i class="bi bi-chevron-left"></i>
                        </button>
                        <div class="page-indicator" id="page-indicator">
                            Page 1 of 1
                        </div>
                        <button type="button" class="btn btn-enhanced btn-outline-enhanced btn-sm" onclick="nextPage()">
                            <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 1;
        let proposalPages = [];

        // Department configurations
        const departments = {
            engineering: { name: 'College of Engineering', class: 'dept-engineering' },
            business: { name: 'College of Business', class: 'dept-business' },
            education: { name: 'College of Education', class: 'dept-education' },
            arts: { name: 'College of Arts & Sciences', class: 'dept-arts' },
            science: { name: 'College of Computer Science', class: 'dept-science' }
        };

        // Initialize budget calculations
        document.addEventListener('DOMContentLoaded', function() {
            setupBudgetCalculations();
            generateProposal(); // Generate initial preview
        });

        function setupBudgetCalculations() {
            const table = document.getElementById('budget-table');
            table.addEventListener('input', function(e) {
                if (e.target.classList.contains('unit-price') || e.target.classList.contains('quantity')) {
                    calculateRowTotal(e.target.closest('tr'));
                    calculateGrandTotal();
                }
            });
        }

        function calculateRowTotal(row) {
            const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const total = unitPrice * quantity;
            row.querySelector('.total-price').textContent = `₱${total.toFixed(2)}`;
        }

        function calculateGrandTotal() {
            const totalPrices = document.querySelectorAll('.total-price');
            let grandTotal = 0;
            
            totalPrices.forEach(cell => {
                const value = parseFloat(cell.textContent.replace('₱', '')) || 0;
                grandTotal += value;
            });
            
            document.getElementById('grand-total').textContent = `₱${grandTotal.toFixed(2)}`;
        }

        function addBudgetRow() {
            const tbody = document.getElementById('budget-tbody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="budget-input" placeholder="Item name"></td>
                <td><input type="number" class="budget-input unit-price" placeholder="0.00" step="0.01"></td>
                <td><input type="text" class="budget-input" placeholder="Size/Description"></td>
                <td><input type="number" class="budget-input quantity" placeholder="1" min="1"></td>
                <td class="total-price">₱0.00</td>
                <td><button type="button" class="remove-row-btn" onclick="removeRow(this)">×</button></td>
            `;
            tbody.appendChild(newRow);
        }

        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
            calculateGrandTotal();
        }

        let currentTimeSelector = null;
        let currentTimeType = null;

        function addProgramRow() {
            const container = document.getElementById('program-rows');
            const newRow = document.createElement('div');
            newRow.className = 'program-row';
            newRow.innerHTML = `
                <div class="time-selector" onclick="openTimeSelector(this, 'start')">
                    <span class="time-display">Click to select time</span>
                    <i class="bi bi-clock"></i>
                </div>
                <div class="time-selector" onclick="openTimeSelector(this, 'end')">
                    <span class="time-display">Click to select time</span>
                    <i class="bi bi-clock"></i>
                </div>
                <div class="activity-input-container">
                    <input type="text" class="activity-input" placeholder="Enter activity description">
                </div>
                <div class="action-container">
                    <button type="button" class="remove-program-btn" onclick="removeProgramRow(this)">×</button>
                </div>
            `;
            container.appendChild(newRow);
        }

        function removeProgramRow(button) {
            const row = button.closest('.program-row');
            row.remove();
        }

        function openTimeSelector(element, type) {
            currentTimeSelector = element;
            currentTimeType = type;
            
            // Clear previous selection styling
            document.querySelectorAll('.time-selector').forEach(sel => {
                sel.classList.remove('selected');
            });
            
            // Highlight selected time selector
            element.classList.add('selected');
            
            // Show modal
            document.getElementById('time-picker-modal').style.display = 'flex';
            
            // Parse existing time if any
            const timeDisplay = element.querySelector('.time-display').textContent;
            if (timeDisplay !== 'Click to select time') {
                parseExistingTime(timeDisplay);
            }
        }

        function parseExistingTime(timeString) {
            const match = timeString.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
            if (match) {
                const hour = parseInt(match[1]);
                const minute = match[2];
                const ampm = match[3].toUpperCase();
                
                document.getElementById('hour-select').value = hour;
                document.getElementById('minute-select').value = minute;
                document.getElementById('ampm-select').value = ampm;
            }
        }

        function closeTimeModal() {
            document.getElementById('time-picker-modal').style.display = 'none';
            
            // Remove selection styling
            if (currentTimeSelector) {
                currentTimeSelector.classList.remove('selected');
            }
            
            currentTimeSelector = null;
            currentTimeType = null;
        }

        function confirmTimeSelection() {
            if (!currentTimeSelector) return;
            
            const hour = document.getElementById('hour-select').value;
            const minute = document.getElementById('minute-select').value;
            const ampm = document.getElementById('ampm-select').value;
            
            const timeString = `${hour}:${minute} ${ampm}`;
            
            // Update the time display
            const timeDisplay = currentTimeSelector.querySelector('.time-display');
            timeDisplay.textContent = timeString;
            timeDisplay.style.color = '#2c3e50';
            timeDisplay.style.fontWeight = '600';
            
            // Store the time value as data attribute
            currentTimeSelector.setAttribute('data-time', timeString);
            
            closeTimeModal();
            
            // Trigger proposal regeneration
            clearTimeout(window.generateTimeout);
            window.generateTimeout = setTimeout(generateProposal, 500);
        }

        function generateProposal() {
            const data = collectFormData();
            const content = generateProposalContent(data);
            createPages(content);
            showPageControls();
        }

        function collectFormData() {
            return {
                date: document.getElementById('proposal-date').value,
                organizer: document.getElementById('project-organizer').value,
                support: document.getElementById('support').value,
                title: document.getElementById('project-title').value,
                facilitator: document.getElementById('lead-facilitator').value,
                department: document.getElementById('department').value,
                rationale: document.getElementById('rationale').value,
                objectives: document.getElementById('objectives').value,
                learningOutcomes: document.getElementById('learning-outcomes').value,
                budgetSource: document.getElementById('budget-source').value,
                mechanics: document.getElementById('mechanics').value,
                schedule: document.getElementById('schedule').value,
                program: collectProgramData(),
                venue: document.getElementById('venue').value,
                budget: collectBudgetData()
            };
        }

        function collectBudgetData() {
            const rows = document.querySelectorAll('#budget-tbody tr');
            const budget = [];
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('.budget-input');
                const unit = inputs[0].value;
                const unitPrice = parseFloat(inputs[1].value) || 0;
                const size = inputs[2].value;
                const quantity = parseFloat(inputs[3].value) || 0;
                const total = unitPrice * quantity;
                
                if (unit || unitPrice || size || quantity) {
                    budget.push({ unit, unitPrice, size, quantity, total });
                }
            });
            
            return budget;
        }

        function collectProgramData() {
            const rows = document.querySelectorAll('.program-row');
            const program = [];
            
            rows.forEach(row => {
                const timeSelectors = row.querySelectorAll('.time-selector');
                const activityInput = row.querySelector('.activity-input');
                
                const startTime = timeSelectors[0].getAttribute('data-time') || '';
                const endTime = timeSelectors[1].getAttribute('data-time') || '';
                const activity = activityInput.value || '';
                
                if (startTime || endTime || activity) {
                    program.push({ 
                        startTime: startTime, 
                        endTime: endTime, 
                        activity: activity 
                    });
                }
            });
            
            return program;
        }

        function generateProposalContent(data) {
            const dept = departments[data.department] || { name: 'College of [Department]', class: 'dept-engineering' };
            
            let content = `
                <div class="paper-header">
                    <div class="logo-placeholder">LOGO</div>
                    <div class="header-center">
                        <div class="college-name">Systems Plus College Foundation</div>
                        <div class="department-name ${dept.class}">${dept.name}</div>
                    </div>
                    <div class="logo-placeholder">LOGO</div>
                </div>

                <div class="proposal-content">
                    <div class="proposal-section">
                        <div class="section-title">Date:</div>
                        <div class="section-content">${data.date || '[Date]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Project Organizer:</div>
                        <div class="section-content">${data.organizer || '[Project Organizer]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Support:</div>
                        <div class="section-content">${formatParagraph(data.support) || '[Support Details]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Project Title:</div>
                        <div class="section-content">${data.title || '[Project Title]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Lead Facilitator:</div>
                        <div class="section-content">${data.facilitator || '[Lead Facilitator]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Rationale:</div>
                        <div class="section-content">${formatParagraph(data.rationale) || '[Project Rationale]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Objectives:</div>
                        <div class="section-content">
                            <ul class="bullet-list">
                                ${formatBulletList(data.objectives) || '<li>[Objective 1]</li><li>[Objective 2]</li>'}
                            </ul>
                        </div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Intended Learning Outcomes:</div>
                        <div class="section-content">
                            <ul class="bullet-list">
                                ${formatBulletList(data.learningOutcomes) || '<li>[Learning Outcome 1]</li><li>[Learning Outcome 2]</li>'}
                            </ul>
                        </div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Budget Requirements:</div>
                        <div class="section-content">
                            ${generateBudgetTable(data.budget)}
                        </div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Source of Budget:</div>
                        <div class="section-content">${data.budgetSource || '[Budget Source]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Mechanics:</div>
                        <div class="section-content">${formatParagraph(data.mechanics) || '[Project Mechanics]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Schedule:</div>
                        <div class="section-content">${formatParagraph(data.schedule) || '[Project Schedule]'}</div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Program:</div>
                        <div class="section-content">
                            ${generateProgramTable(data.program)}
                        </div>
                    </div>

                    <div class="proposal-section">
                        <div class="section-title">Venue:</div>
                        <div class="section-content">${formatParagraph(data.venue) || '[Venue Details]'}</div>
                    </div>
                </div>
            `;

            return content;
        }

        function formatParagraph(text) {
            if (!text) return '';
            return text.replace(/\n/g, '<br>');
        }

        function formatBulletList(text) {
            if (!text) return '';
            return text.split('\n')
                      .filter(line => line.trim())
                      .map(line => `<li>${line.trim()}</li>`)
                      .join('');
        }

        function generateBudgetTable(budget) {
            if (!budget || budget.length === 0) {
                return `
                    <table class="budget-table">
                        <thead>
                            <tr>
                                <th>Unit</th>
                                <th>Unit Price</th>
                                <th>Size</th>
                                <th>Quantity</th>
                                <th>Total Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>[Item 1]</td>
                                <td>₱0.00</td>
                                <td>[Size]</td>
                                <td>1</td>
                                <td>₱0.00</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="4" style="text-align: right; font-weight: bold;">Grand Total:</td>
                                <td>₱0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                `;
            }

            let grandTotal = 0;
            const rows = budget.map(item => {
                grandTotal += item.total;
                return `
                    <tr>
                        <td>${item.unit}</td>
                        <td>₱${item.unitPrice.toFixed(2)}</td>
                        <td>${item.size}</td>
                        <td>${item.quantity}</td>
                        <td>₱${item.total.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');

            return `
                <table class="budget-table">
                    <thead>
                        <tr>
                            <th>Unit</th>
                            <th>Unit Price</th>
                            <th>Size</th>
                            <th>Quantity</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td colspan="4" style="text-align: right; font-weight: bold;">Grand Total:</td>
                            <td>₱${grandTotal.toFixed(2)}</td>
                        </tr>
                    </tfoot>
                </table>
            `;
        }

        function generateProgramTable(program) {
            if (!program || program.length === 0) {
                return `
                    <table class="budget-table">
                        <thead>
                            <tr>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Activity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>9:00 AM</td>
                                <td>10:00 AM</td>
                                <td>[Activity 1]</td>
                            </tr>
                            <tr>
                                <td>10:00 AM</td>
                                <td>11:00 AM</td>
                                <td>[Activity 2]</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }

            const rows = program.map(item => {
                const startTime = item.startTime || '[Start Time]';
                const endTime = item.endTime || '[End Time]';
                const activity = item.activity || '[Activity Description]';
                
                return `
                    <tr>
                        <td>${startTime}</td>
                        <td>${endTime}</td>
                        <td>${activity}</td>
                    </tr>
                `;
            }).join('');

            return `
                <table class="budget-table">
                    <thead>
                        <tr>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            `;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
            
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function createPages(content) {
            const container = document.getElementById('paper-container');
            container.innerHTML = '';
            
            // Create a temporary div to measure content
            const tempDiv = document.createElement('div');
            tempDiv.className = 'paper-page active';
            tempDiv.innerHTML = content;
            tempDiv.style.visibility = 'hidden';
            tempDiv.style.position = 'absolute';
            document.body.appendChild(tempDiv);

            // Split content into pages based on height
            const maxHeight = 9.5 * 96; // Approximate height in pixels (11in - 1.5in margins)
            const sections = tempDiv.querySelectorAll('.proposal-section');
            
            let currentPageContent = `
                <div class="paper-header">
                    ${tempDiv.querySelector('.paper-header').innerHTML}
                </div>
                <div class="proposal-content">
            `;
            let currentHeight = 200; // Approximate header height
            let pageNumber = 1;
            
            sections.forEach((section, index) => {
                const sectionHeight = section.offsetHeight;
                
                if (currentHeight + sectionHeight > maxHeight && pageNumber > 1) {
                    // Close current page and start new one
                    currentPageContent += '</div>';
                    createPage(currentPageContent, pageNumber);
                    
                    pageNumber++;
                    currentPageContent = `
                        <div class="paper-header">
                            ${tempDiv.querySelector('.paper-header').innerHTML}
                        </div>
                        <div class="proposal-content">
                    `;
                    currentHeight = 200;
                }
                
                currentPageContent += section.outerHTML;
                currentHeight += sectionHeight;
            });
            
            // Close final page
            currentPageContent += '</div>';
            createPage(currentPageContent, pageNumber);
            
            document.body.removeChild(tempDiv);
            
            totalPages = pageNumber;
            currentPage = 1;
            updatePageDisplay();
        }

        function createPage(content, pageNum) {
            const container = document.getElementById('paper-container');
            const page = document.createElement('div');
            page.className = 'paper-page';
            page.id = `page-${pageNum}`;
            page.innerHTML = content;
            
            if (pageNum === 1) {
                page.classList.add('active');
            }
            
            container.appendChild(page);
        }

        function showPageControls() {
            const controls = document.getElementById('page-controls');
            controls.style.display = totalPages > 1 ? 'flex' : 'none';
        }

        function updatePageDisplay() {
            // Hide all pages
            document.querySelectorAll('.paper-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show current page
            const currentPageElement = document.getElementById(`page-${currentPage}`);
            if (currentPageElement) {
                currentPageElement.classList.add('active');
            }
            
            // Update page indicator
            document.getElementById('page-indicator').textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePageDisplay();
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePageDisplay();
            }
        }

        function togglePreview() {
            document.body.classList.toggle('preview-mode');
        }

        function printProposal() {
            window.print();
        }

        // Auto-generate proposal on input changes
        document.addEventListener('input', function(e) {
            if (e.target.closest('#editor-panel')) {
                clearTimeout(window.generateTimeout);
                window.generateTimeout = setTimeout(generateProposal, 500);
            }
        });

        // Initialize calculations on page load
        calculateGrandTotal();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ef7aba5728db22',t:'MTc1Nzg0ODY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
